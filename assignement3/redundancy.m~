%% Gaussian X
Keep = 1;

X = randn(50,500);
mu = mean(X,2);
X = X - mu;
cmat = cov(X');
[v,d] = eig(cmat);
d = diag(d);
[sort_d,ind_big] = sort(d, 'descend');

for q = 1:length(sort_d)
    if (sum(sort_d(1:q)) / sum(sort_d) >= Keep)
        break
    end
end
E = v(:,ind_big(1:q));
Z = E'*X;
Xhat = E*Z+mu;

sqrt(mean(mean((X-Xhat).^2)))

%% Choles all
